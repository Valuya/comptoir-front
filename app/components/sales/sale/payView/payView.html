<div class="payView" *ng-if="hasSale()">
    <div>
        <div class="toPayHeader coloredHeader"
             [class.inactive]="noInput"
             [hidden]="sale.totalPaid >= sale.vatExclusiveAmount + sale.vatAmount">
            <h1>À payer</h1>
            <span class="busy">
                <span class="valignAnchor"></span>
                <img src="res/img/spinner-2-white.gif"
                     [hidden]="!sale.dirty"/>
            </span>
            <span class="actions">
                <span class="valignAnchor"></span>
                <span class="total single">
                    {{  (sale.vatExclusiveAmount + sale.vatAmount) - sale.totalPaid | currency:'EUR':true:'.2-2' }}
                </span>
            </span>
        </div>

        <div class="toPayHeader coloredHeader"
             [class.inactive]="noInput"
             [hidden]="sale.totalPaid < sale.vatExclusiveAmount + sale.vatAmount">
            <h1 [hidden]="noInput">À rendre</h1>
            <h1 [hidden]="!noInput">Rendu</h1>
            <span class="busy">
                <span class="valignAnchor"></span>
                <img src="res/img/spinner-2-white.gif"
                     [hidden]="!sale.dirty"/>
            </span>

            <span class="actions">
                <span class="valignAnchor"></span>
                <span class="total"
                      [class.negative]="sale.totalPaid > sale.vatExclusiveAmount + sale.vatAmount"
                      [class.exact]="sale.totalPaid == sale.vatExclusiveAmount + sale.vatAmount">
                    {{ sale.totalPaid - (sale.vatExclusiveAmount + sale.vatAmount)  | currency:'EUR':true:'.2-2'}}
                </span>
                <span class="action validateLink"
                      [hidden]="noInput"
                      (click)="onValidateClicked()">
                    Valider
                </span>
            </span>
        </div>
    </div>

    <table class="payItems dataTable" [hidden]="sale.accountingEntries.length == 0">
        <thead>
        <tr>
            <th>Compte</th>
            <th class="number total">Montant</th>
            <th class="actions"></th>
        </tr>
        </thead>
        <tbody>
        <tr *ng-for="#entry of sale.accountingEntries" class="payItem">
            <td>
                <span *ng-if="entry.account != null">
                    {{ entry.account.description[locale] }}
                </span>
            </td>
            <td class="number total">
                <a class="edit actionlink"
                   (^click)="startEditEntry(entry)"
                   [hidden]="noInput">
                    {{ entry.amount | currency:'EUR':true:'.2-2' }}
                </a>
                <span [hidden]="!noInput">
                     {{ entry.amount | currency:'EUR':true:'.2-2' }}
                </span>
            </td>

            <td class="actions"  [hidden]="noInput">
                <a class="actionIcon remove" (^click)="removePayItem(pay)">
                    <i class="fi-x red"></i>
                </a>
            </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <th class="right">Total</th>
            <th class="number total">
                {{ sale.totalPaid | currency:'EUR':true:'.2-2' }}
            </th>
        </tr>

        </tfoot>
    </table>

    <div class="editMethod" *ng-if="editingEntry != null"  [hidden]="noInput">
        <span class="method">{{ editingEntry.account.description[locale] }}</span>
        <span class="amount">
            Montant: <input #amount
                            [value]="editingEntry.amount"
                            type="number" min="0.01" step="0.01"
                            [validator]="validateEntryAmount"
                            (fast-change)="applyEditingEntry($event)"
                            fast-input> €
        </span>
    </div>

    <div class="addMethod" [hidden]="noInput">
        <div *ng-for="#account of allAccounts"
             class="boxedHoverableLink"
             (^click)="startEditNewEntry(account)">
            {{ account.description[locale] }}
        </div>
    </div>
</div>

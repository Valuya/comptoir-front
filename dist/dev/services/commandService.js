var CommandItem = (function () {
    function CommandItem(item) {
        this.item = item;
        this.amount = 0;
        this.reduction = null;
        this.price = 0;
    }
    return CommandItem;
})();
exports.CommandItem = CommandItem;
var CommandService = (function () {
    function CommandService() {
        this.items = [];
        this.totalPrice = 0;
        this.globalReduction = null;
    }
    CommandService.prototype.reset = function () {
        this.items = [];
        this.totalPrice = 0;
        this.globalReduction = null;
    };
    CommandService.prototype.addItem = function (item) {
        var id = item.id;
        var commandItem = this.getCommandItem(item);
        if (commandItem == null) {
            commandItem = new CommandItem(item);
            this.items.push(commandItem);
        }
        commandItem.amount++;
        this.calcItemPrice(commandItem);
        this.calcTotalPrice();
    };
    CommandService.prototype.removeItem = function (item) {
        var oldItems = this.items;
        var newItems = [];
        oldItems.forEach(function (commandItem) {
            if (commandItem.item.equals(item)) {
                return;
            }
            newItems.push(commandItem);
        });
        this.items = newItems;
        this.calcTotalPrice();
    };
    CommandService.prototype.addCommandItem = function (commandItem) {
        this.calcItemPrice(commandItem);
        this.items.push(commandItem);
        this.calcTotalPrice();
    };
    CommandService.prototype.removeCommandItem = function (commandItem) {
        var oldItems = this.items;
        var newItems = [];
        oldItems.forEach(function (existingItem) {
            if (commandItem == existingItem) {
                return;
            }
            newItems.push(existingItem);
        });
        this.items = newItems;
        this.calcTotalPrice();
    };
    CommandService.prototype.getCommandItem = function (item) {
        var foundCommandItem = null;
        this.items.forEach(function (commandItem) {
            if (commandItem.item.equals(item)) {
                foundCommandItem = commandItem;
                return;
            }
        });
        return foundCommandItem;
    };
    CommandService.prototype.getItems = function () {
        return this.items;
    };
    CommandService.prototype.setReduction = function (item, reduction) {
        var commandItem = this.getCommandItem(item);
        if (commandItem == null) {
            return;
        }
        commandItem.reduction = reduction;
        this.calcItemPrice(commandItem);
        this.calcTotalPrice();
    };
    CommandService.prototype.calcTotalPrice = function () {
        this.totalPrice = 0;
        var thisService = this;
        this.items.forEach(function (item) {
            var price = item.price;
            thisService.totalPrice += price;
        });
        if (this.globalReduction != null) {
            var reduction = this.globalReduction * 0.01 * this.totalPrice;
            this.totalPrice -= reduction;
        }
    };
    CommandService.prototype.calcItemPrice = function (commandItem) {
        var item = commandItem.item;
        if (item == null) {
            return;
        }
        var itemPrice = item.currentPrice;
        var amount = commandItem.amount;
        var totalPrice = amount * itemPrice;
        var reduction = commandItem.reduction;
        if (reduction != null) {
            var reductionAmount = reduction * 0.01 * totalPrice;
            totalPrice -= reductionAmount;
        }
        commandItem.price = totalPrice;
    };
    return CommandService;
})();
exports.CommandService = CommandService;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL2NvbW1hbmRTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbIkNvbW1hbmRJdGVtIiwiQ29tbWFuZEl0ZW0uY29uc3RydWN0b3IiLCJDb21tYW5kU2VydmljZSIsIkNvbW1hbmRTZXJ2aWNlLmNvbnN0cnVjdG9yIiwiQ29tbWFuZFNlcnZpY2UucmVzZXQiLCJDb21tYW5kU2VydmljZS5hZGRJdGVtIiwiQ29tbWFuZFNlcnZpY2UucmVtb3ZlSXRlbSIsIkNvbW1hbmRTZXJ2aWNlLmFkZENvbW1hbmRJdGVtIiwiQ29tbWFuZFNlcnZpY2UucmVtb3ZlQ29tbWFuZEl0ZW0iLCJDb21tYW5kU2VydmljZS5nZXRDb21tYW5kSXRlbSIsIkNvbW1hbmRTZXJ2aWNlLmdldEl0ZW1zIiwiQ29tbWFuZFNlcnZpY2Uuc2V0UmVkdWN0aW9uIiwiQ29tbWFuZFNlcnZpY2UuY2FsY1RvdGFsUHJpY2UiLCJDb21tYW5kU2VydmljZS5jYWxjSXRlbVByaWNlIl0sIm1hcHBpbmdzIjoiQUFLQTtJQU1JQSxxQkFBWUEsSUFBVUE7UUFDbEJDLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1FBQ2pCQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFFQSxDQUFDQSxDQUFDQTtRQUNmQSxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUN0QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDbkJBLENBQUNBO0lBQ0xELGtCQUFDQTtBQUFEQSxDQVpBLEFBWUNBLElBQUE7QUFaWSxtQkFBVyxjQVl2QixDQUFBO0FBRUQ7SUFLSUU7UUFDSUMsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDaEJBLElBQUlBLENBQUNBLFVBQVVBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3BCQSxJQUFJQSxDQUFDQSxlQUFlQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUNoQ0EsQ0FBQ0E7SUFFREQsOEJBQUtBLEdBQUxBO1FBQ0lFLElB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QVNBLEdBQUdBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLElBQUlBLEdBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBO1lBQy9EQSxJQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxTQUFTQSxDQUFDQTtRQUNqQ0EsQ0FBQ0E7SUFDTEEsQ0FBQ0E7SUFDRFYsc0NBQWFBLEdBQWJBLFVBQWNBLFdBQXdCQTtRQUNsQ1csSUFBSUEsSUFBSUEsR0FBR0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDNUJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ2ZBLE1BQU1BLENBQUNBO1FBQ1hBLENBQUNBO1FBQ0RBLElBQUlBLFNBQVNBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBO1FBQ2xDQSxJQUFJQSxNQUFNQSxHQUFHQSxXQUFXQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNoQ0EsSUFBSUEsVUFBVUEsR0FBR0EsTUFBTUEsR0FBR0EsU0FBU0EsQ0FBRUE7UUFFckNBLElBQUlBLFNBQVNBLEdBQUdBLFdBQVdBLENBQUNBLFNBQVNBLENBQUNBO1FBQ3RDQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQkEsSUFBSUEsZUFBZUEsR0FBR0EsU0FBU0EsR0FBR0EsSUFBSUEsR0FBR0EsVUFBVUEsQ0FBQ0E7WUFDcERBLFVBQVVBLElBQUlBLGVBQWVBLENBQUNBO1FBQ2xDQSxDQUFDQTtRQUNEQSxXQUFXQSxDQUFDQSxLQUFLQSxHQUFHQSxVQUFVQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFDTFgscUJBQUNBO0FBQURBLENBM0dBLEFBMkdDQSxJQUFBO0FBM0dZLHNCQUFjLGlCQTJHMUIsQ0FBQSIsImZpbGUiOiJzZXJ2aWNlcy9jb21tYW5kU2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBjZ2hpc2xhaSBvbiAyOC8wNy8xNS5cbiAqL1xuaW1wb3J0IHtJdGVtfSBmcm9tICdzZXJ2aWNlcy9pdGVtU2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBDb21tYW5kSXRlbSB7XG4gICAgaXRlbTogSXRlbTtcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgICByZWR1Y3Rpb246IG51bWJlcjtcbiAgICBwcmljZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoaXRlbTogSXRlbSkge1xuICAgICAgICB0aGlzLml0ZW0gPSBpdGVtO1xuICAgICAgICB0aGlzLmFtb3VudCA9MDtcbiAgICAgICAgdGhpcy5yZWR1Y3Rpb24gPSBudWxsO1xuICAgICAgICB0aGlzLnByaWNlID0gMDtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb21tYW5kU2VydmljZSB7XG4gICAgaXRlbXM6IENvbW1hbmRJdGVtW107XG4gICAgZ2xvYmFsUmVkdWN0aW9uOiBudW1iZXI7XG4gICAgdG90YWxQcmljZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy50b3RhbFByaWNlID0gMDtcbiAgICAgICAgdGhpcy5nbG9iYWxSZWR1Y3Rpb24gPSBudWxsO1xuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLml0ZW1zID0gW107XG4gICAgICAgIHRoaXMudG90YWxQcmljZSA9IDA7XG4gICAgICAgIHRoaXMuZ2xvYmFsUmVkdWN0aW9uID0gbnVsbDtcbiAgICB9XG5cbiAgICBhZGRJdGVtKGl0ZW06IEl0ZW0pIHtcbiAgICAgICAgdmFyIGlkID0gaXRlbS5pZDtcbiAgICAgICAgdmFyIGNvbW1hbmRJdGVtOiBDb21tYW5kSXRlbSA9IHRoaXMuZ2V0Q29tbWFuZEl0ZW0oaXRlbSk7XG4gICAgICAgIGlmIChjb21tYW5kSXRlbSA9PSBudWxsKSB7XG4gICAgICAgICAgICBjb21tYW5kSXRlbSA9IG5ldyBDb21tYW5kSXRlbShpdGVtKTtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaChjb21tYW5kSXRlbSk7XG4gICAgICAgIH1cbiAgICAgICAgY29tbWFuZEl0ZW0uYW1vdW50Kys7XG4gICAgICAgIHRoaXMuY2FsY0l0ZW1QcmljZShjb21tYW5kSXRlbSk7XG4gICAgICAgIHRoaXMuY2FsY1RvdGFsUHJpY2UoKTtcbiAgICB9XG4gICAgcmVtb3ZlSXRlbShpdGVtOiBJdGVtKSB7XG4gICAgICAgIHZhciBvbGRJdGVtcyA9IHRoaXMuaXRlbXM7XG4gICAgICAgIHZhciBuZXdJdGVtczpDb21tYW5kSXRlbVtdID0gW107XG4gICAgICAgIG9sZEl0ZW1zLmZvckVhY2goZnVuY3Rpb24oY29tbWFuZEl0ZW06IENvbW1hbmRJdGVtKSB7XG4gICAgICAgICAgICBpZiAoY29tbWFuZEl0ZW0uaXRlbS5lcXVhbHMoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdJdGVtcy5wdXNoKGNvbW1hbmRJdGVtKTtcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5pdGVtcyA9IG5ld0l0ZW1zO1xuICAgICAgICB0aGlzLmNhbGNUb3RhbFByaWNlKCk7XG4gICAgfVxuICAgIGFkZENvbW1hbmRJdGVtKGNvbW1hbmRJdGVtOiBDb21tYW5kSXRlbSkge1xuICAgICAgICB0aGlzLmNhbGNJdGVtUHJpY2UoY29tbWFuZEl0ZW0pO1xuICAgICAgICB0aGlzLml0ZW1zLnB1c2goY29tbWFuZEl0ZW0pO1xuICAgICAgICB0aGlzLmNhbGNUb3RhbFByaWNlKCk7XG4gICAgfVxuICAgIHJlbW92ZUNvbW1hbmRJdGVtKGNvbW1hbmRJdGVtOiBDb21tYW5kSXRlbSkge1xuICAgICAgICB2YXIgb2xkSXRlbXMgPSB0aGlzLml0ZW1zO1xuICAgICAgICB2YXIgbmV3SXRlbXM6Q29tbWFuZEl0ZW1bXSA9IFtdO1xuICAgICAgICBvbGRJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGV4aXN0aW5nSXRlbTogQ29tbWFuZEl0ZW0pIHtcbiAgICAgICAgICAgIGlmIChjb21tYW5kSXRlbSA9PSBleGlzdGluZ0l0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXdJdGVtcy5wdXNoKGV4aXN0aW5nSXRlbSk7XG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuaXRlbXMgPSBuZXdJdGVtcztcbiAgICAgICAgdGhpcy5jYWxjVG90YWxQcmljZSgpO1xuICAgIH1cbiAgICBnZXRDb21tYW5kSXRlbShpdGVtOiBJdGVtKSB7XG4gICAgICAgIHZhciBmb3VuZENvbW1hbmRJdGVtID0gbnVsbDtcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGNvbW1hbmRJdGVtOiBDb21tYW5kSXRlbSkge1xuICAgICAgICAgICAgaWYgKGNvbW1hbmRJdGVtLml0ZW0uZXF1YWxzKGl0ZW0pKSB7XG4gICAgICAgICAgICAgICAgZm91bmRDb21tYW5kSXRlbSA9IGNvbW1hbmRJdGVtO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmb3VuZENvbW1hbmRJdGVtO1xuICAgIH1cbiAgICBnZXRJdGVtcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXM7XG4gICAgfVxuICAgIHNldFJlZHVjdGlvbihpdGVtOiBJdGVtLCByZWR1Y3Rpb246IG51bWJlcikge1xuICAgICAgICB2YXIgY29tbWFuZEl0ZW06Q29tbWFuZEl0ZW0gPSB0aGlzLmdldENvbW1hbmRJdGVtKGl0ZW0pO1xuICAgICAgICBpZiAoY29tbWFuZEl0ZW0gPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbW1hbmRJdGVtLnJlZHVjdGlvbiA9IHJlZHVjdGlvbjtcbiAgICAgICAgdGhpcy5jYWxjSXRlbVByaWNlKGNvbW1hbmRJdGVtKTtcbiAgICAgICAgdGhpcy5jYWxjVG90YWxQcmljZSgpO1xuICAgIH1cbiAgICBjYWxjVG90YWxQcmljZSgpIHtcbiAgICAgICAgdGhpcy50b3RhbFByaWNlID0gMDtcbiAgICAgICAgdmFyIHRoaXNTZXJ2aWNlID0gdGhpcztcbiAgICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW06IENvbW1hbmRJdGVtKSB7XG4gICAgICAgICAgICB2YXIgcHJpY2UgPSBpdGVtLnByaWNlO1xuICAgICAgICAgICAgdGhpc1NlcnZpY2UudG90YWxQcmljZSArPSBwcmljZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0aGlzLmdsb2JhbFJlZHVjdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgcmVkdWN0aW9uID0gdGhpcy5nbG9iYWxSZWR1Y3Rpb24gKiAwLjAxICAqIHRoaXMudG90YWxQcmljZTtcbiAgICAgICAgICAgIHRoaXMudG90YWxQcmljZSAtPSByZWR1Y3Rpb247XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2FsY0l0ZW1QcmljZShjb21tYW5kSXRlbTogQ29tbWFuZEl0ZW0pIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBjb21tYW5kSXRlbS5pdGVtO1xuICAgICAgICBpZiAoaXRlbSA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGl0ZW1QcmljZSA9IGl0ZW0uY3VycmVudFByaWNlO1xuICAgICAgICB2YXIgYW1vdW50ID0gY29tbWFuZEl0ZW0uYW1vdW50O1xuICAgICAgICB2YXIgdG90YWxQcmljZSA9IGFtb3VudCAqIGl0ZW1QcmljZSA7XG5cbiAgICAgICAgdmFyIHJlZHVjdGlvbiA9IGNvbW1hbmRJdGVtLnJlZHVjdGlvbjtcbiAgICAgICAgaWYgKHJlZHVjdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgcmVkdWN0aW9uQW1vdW50ID0gcmVkdWN0aW9uICogMC4wMSAqIHRvdGFsUHJpY2U7XG4gICAgICAgICAgICB0b3RhbFByaWNlIC09IHJlZHVjdGlvbkFtb3VudDtcbiAgICAgICAgfVxuICAgICAgICBjb21tYW5kSXRlbS5wcmljZSA9IHRvdGFsUHJpY2U7XG4gICAgfVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==